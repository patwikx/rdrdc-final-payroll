%%{init: {"theme": "base", "themeVariables": {"fontSize": "11px"}, "flowchart": {"htmlLabels": true, "nodeSpacing": 40, "rankSpacing": 55}}}%%
flowchart LR
  subgraph EMP[Employee]
    EMP1[Submit Leave or Overtime Request]
    EMP2[Edit Pending Request]
    EMP3[Withdraw Pending Request]
    EMP4[Receive Final Decision Notification]
  end

  subgraph SYS[System]
    SYS1[Check Request Completeness and Eligibility]
    SYS2[Route to Supervisor]
    SYS3{Pending Update from Employee?}
    SYS4[Save Updated Request]
    SYS5[Mark as Withdrawn]
    SYS6{Approved Request Type?}
    SYS7[Leave: Apply Final Leave Balance Movement]
    SYS8[Overtime: Apply Final Overtime Outcome<br/>Payroll OT or CTO Based on Policy]
    SYS9[Record Decision and Send Notification]
  end

  subgraph SUP[Supervisor]
    SUP1[Review Request]
    SUPD{Supervisor Decision}
    SUP2[Reject Request]
    SUP3[Approve and Forward to HR]
  end

  subgraph HR[HR Staff]
    HR1[Final HR Review]
    HRD{HR Decision}
    HR2[Reject Request]
    HR3[Approve Request]
  end

  EMP1 --> SYS1 --> SYS2 --> SYS3
  SYS3 -- Edit --> EMP2 --> SYS4 --> SYS2
  SYS3 -- Withdraw --> EMP3 --> SYS5 --> SYS9 --> EMP4
  SYS3 -- No --> SUP1 --> SUPD
  SUPD -- Reject --> SUP2 --> SYS9 --> EMP4
  SUPD -- Approve --> SUP3 --> HR1 --> HRD
  HRD -- Reject --> HR2 --> SYS9 --> EMP4
  HRD -- Approve --> HR3 --> SYS6
  SYS6 -- Leave --> SYS7 --> SYS9 --> EMP4
  SYS6 -- Overtime --> SYS8 --> SYS9 --> EMP4

  classDef default fill:#ffffff,stroke:#000000,color:#000000;
